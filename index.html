<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stickman Jetpack Defender</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #1a1a1a; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas { 
            background: #87CEEB; 
            border: 5px solid #444;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            cursor: pointer;
        }
        #ui { 
            position: absolute; 
            top: 20px; 
            left: 50%;
            transform: translateX(-50%);
            color: white; 
            font-size: 20px; 
            text-shadow: 2px 2px #000;
            pointer-events: none;
            width: 760px;
            display: flex;
            justify-content: space-between;
        }
        #start-prompt {
            position: absolute;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <div>Lives: <span id="lives">3</span> | Score: <span id="score">0</span></div>
        <div>JETPACK FUEL</div>
    </div>
    <div id="start-prompt">Click to Start with Sound</div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

// --- AUDIO SYSTEM ---
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;

function initAudio() {
    if (!audioCtx) audioCtx = new AudioCtx();
    document.getElementById('start-prompt').style.display = 'none';
}

const sounds = {
    shoot: () => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    },
    jump: () => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    },
    jet: () => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(60, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.2);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
    },
    hit: () => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(100, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(10, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.3);
    },
    explode: () => {
        const noise = audioCtx.createBufferSource();
        const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.2, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
        noise.buffer = buffer;
        const filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        noise.start();
    }
};

// --- GAME STATE ---
let lives = 3;
let score = 0;
let gameActive = true;
const gravity = 0.7;
const keys = {};

// --- PLAYER OBJECT ---
const player = {
    x: 80, y: 300, w: 30, h: 50,
    dy: 0,
    jumpPower: -14,
    jetPower: -18,
    fuel: 100,
    maxFuel: 100,
    grounded: false,
    isJetting: false,
    
    draw() {
        ctx.save();
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;

        if (this.isJetting) {
            ctx.fillStyle = Math.random() > 0.5 ? "#FF4500" : "#FFD700";
            ctx.beginPath();
            ctx.moveTo(this.x + 2, this.y + 40);
            ctx.lineTo(this.x + 10, this.y + 65);
            ctx.lineTo(this.x + 18, this.y + 40);
            ctx.fill();
        }

        ctx.beginPath(); ctx.arc(this.x + 15, this.y, 10, 0, Math.PI * 2); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(this.x + 15, this.y + 10); ctx.lineTo(this.x + 15, this.y + 35); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(this.x + 15, this.y + 20); ctx.lineTo(this.x + 35, this.y + 20); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(this.x + 15, this.y + 35); ctx.lineTo(this.x + 5, this.y + 50); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(this.x + 15, this.y + 35); ctx.lineTo(this.x + 25, this.y + 50); ctx.stroke();
        ctx.fillStyle = "#333"; ctx.fillRect(this.x + 30, this.y + 15, 12, 6);
        ctx.fillStyle = "cyan"; ctx.fillRect(this.x + 40, this.y + 16, 4, 4);
        ctx.fillStyle = "#555";
        ctx.fillRect(this.x + 2, this.y + 15, 10, 25);
        ctx.restore();
    }
};

let bullets = [];
let enemies = [];

// --- INPUTS ---
window.addEventListener('mousedown', initAudio);
window.addEventListener('keydown', e => {
    if (!audioCtx) initAudio();
    keys[e.code] = true;
    if (e.code === 'Space' && gameActive) {
        bullets.push({ x: player.x + 42, y: player.y + 16, w: 12, h: 4 });
        sounds.shoot();
    }
});
window.addEventListener('keyup', e => keys[e.code] = false);

// --- SPAWNING ---
function spawnEnemy() {
    if (!gameActive) return;
    const isAlien = Math.random() > 0.4;
    enemies.push({
        x: canvas.width,
        y: isAlien ? 150 + Math.random() * 150 : 320,
        w: 30, h: 30,
        type: isAlien ? 'alien' : 'spike',
        speed: 4 + (score * 0.2)
    });
    setTimeout(spawnEnemy, Math.max(600, 2000 - (score * 50)));
}

// --- CORE UPDATE ---
function update() {
    if (!gameActive) return;

    if (keys['ArrowUp'] && player.grounded) {
        player.dy = player.jumpPower;
        player.grounded = false;
        sounds.jump();
    }

    if (keys['ArrowDown'] && player.fuel > 25) {
        player.dy = player.jetPower;
        player.fuel -= 30;
        player.isJetting = true;
        player.grounded = false;
        sounds.jet();
        setTimeout(() => player.isJetting = false, 250);
        keys['ArrowDown'] = false;
    }

    if (player.fuel < player.maxFuel) player.fuel += 0.3;

    player.dy += gravity;
    player.y += player.dy;

    if (player.y > 300) {
        player.y = 300;
        player.dy = 0;
        player.grounded = true;
    }

    bullets.forEach((b, i) => {
        b.x += 12;
        if (b.x > canvas.width) bullets.splice(i, 1);
    });

    enemies.forEach((en, i) => {
        en.x -= en.speed;

        if (player.x < en.x + en.w && player.x + player.w > en.x &&
            player.y - 10 < en.y + en.h && player.y + player.h > en.y) {
            enemies.splice(i, 1);
            lives--;
            sounds.hit();
            document.getElementById('lives').innerText = lives;
            if (lives <= 0) {
                gameActive = false;
                alert("Game Over! Score: " + score);
                location.reload();
            }
        }

        bullets.forEach((b, bi) => {
            if (b.x < en.x + en.w && b.x + b.w > en.x && b.y < en.y + en.h && b.y + b.h > en.y) {
                if (en.type === 'alien') {
                    enemies.splice(i, 1);
                    bullets.splice(bi, 1);
                    score++;
                    sounds.explode();
                    document.getElementById('score').innerText = score;
                }
            }
        });

        if (en.x < -50) enemies.splice(i, 1);
    });
}

// --- DRAW LOOP ---
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = "#3d2b1f";
    ctx.fillRect(0, 350, canvas.width, 50);
    ctx.fillStyle = "#2d1b0f";
    ctx.fillRect(0, 350, canvas.width, 5);

    ctx.fillStyle = "#444";
    ctx.fillRect(680, 60, 100, 15);
    ctx.fillStyle = player.fuel > 30 ? "#00ff00" : "#ff4444";
    ctx.fillRect(680, 60, player.fuel, 15);
    ctx.strokeStyle = "white";
    ctx.strokeRect(680, 60, 100, 15);

    player.draw();

    ctx.fillStyle = "cyan";
    bullets.forEach(b => {
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.shadowBlur = 10; ctx.shadowColor = "cyan";
    });
    ctx.shadowBlur = 0; 

    enemies.forEach(en => {
        if (en.type === 'alien') {
            ctx.fillStyle = "#32CD32";
            ctx.beginPath(); ctx.ellipse(en.x + 15, en.y + 15, 18, 12, 0, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(en.x + 8, en.y + 12, 3, 0, 7); ctx.fill();
            ctx.beginPath(); ctx.arc(en.x + 22, en.y + 12, 3, 0, 7); ctx.fill();
        } else {
            ctx.fillStyle = "#777";
            ctx.beginPath(); ctx.moveTo(en.x, en.y + 30); ctx.lineTo(en.x + 15, en.y); ctx.lineTo(en.x + 30, en.y + 30); ctx.fill();
        }
    });

    update();
    requestAnimationFrame(draw);
}

spawnEnemy();
draw();
</script>
</body>
</html>
